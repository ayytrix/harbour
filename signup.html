<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Harbour News Network â€” Sign Up</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" href="https://raw.githubusercontent.com/ayytrix/harbour/refs/heads/main/ChatGPT%20Image%20Oct%2027%2C%202025%2C%2011_00_04%20AM.png">
<style>
  body{margin:0;font-family:Arial,sans-serif;background:#f2f2f2;color:#222}
  header{background:linear-gradient(90deg,#2b3e6b,#163052);padding:12px 20px;color:#fff;display:flex;align-items:center;justify-content:space-between}
  header img{height:44px}
  header .brand{font-weight:700;font-size:18px}
  main{max-width:480px;margin:40px auto;padding:0 16px}
  .card{background:#fff;padding:20px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.1)}
  h2{margin-top:0}
  label{display:block;margin-top:12px;font-size:14px;color:#555}
  input{width:100%;padding:10px;margin-top:4px;border:1px solid #ccc;border-radius:6px;font-size:14px;box-sizing:border-box}
  button{margin-top:16px;padding:10px 14px;border:none;border-radius:6px;background:#1a4a84;color:#fff;font-weight:700;cursor:pointer;font-size:14px;width:100%}
  button:disabled{background:#999;cursor:not-allowed}
  .error{color:#b00020;margin-top:8px;font-weight:700}
  .success{color:green;margin-top:8px;font-weight:700}
  .login-link{margin-top:14px;font-size:13px;color:#555;text-align:center}
  .login-link a{text-decoration:none;color:#1a4a84;font-weight:700}
</style>
</head>
<body>

<header>
  <img src="https://raw.githubusercontent.com/ayytrix/harbour/refs/heads/main/ChatGPT%20Image%20Oct%2027%2C%202025%2C%2011_00_04%20AM.png" alt="HNN">
  <div class="brand">Harbour News Network</div>
</header>

<main>
  <div class="card">
    <h2>Create Account</h2>
    <div id="notice" class="success"></div>
    <form id="signupForm">
      <label for="name">Name</label>
      <input type="text" id="name" required maxlength="50" placeholder="Your full name">

      <label for="email">Email</label>
      <input type="email" id="email" required placeholder="you@example.com">

      <label for="password">Password</label>
      <input type="password" id="password" required placeholder="Password (min 6 characters)">

      <button type="submit" id="signupBtn">Sign Up</button>
      <div id="errorMsg" class="error"></div>
    </form>
    <div class="login-link">
      Already have an account? <a href="login.html">Log In</a>
    </div>
  </div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDocs, collection } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAGtMifXSvavxsk8VLBsJAbrYJxOFs2oes",
  authDomain: "harbour-45dca.firebaseapp.com",
  projectId: "harbour-45dca",
  storageBucket: "harbour-45dca.firebasestorage.app",
  messagingSenderId: "109842774901",
  appId: "1:109842774901:web:0679722f1614ce82bd713c"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const form = document.getElementById("signupForm");
const nameInput = document.getElementById("name");
const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");
const errorMsg = document.getElementById("errorMsg");
const notice = document.getElementById("notice");
const signupBtn = document.getElementById("signupBtn");

// Generate numeric userId
async function generateUserId() {
  const usersSnap = await getDocs(collection(db,"users"));
  let maxId = 0;
  usersSnap.forEach(doc => {
    const data = doc.data();
    if(data.userId && typeof data.userId === "number") maxId = Math.max(maxId,data.userId);
  });
  return maxId + 1;
}

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  errorMsg.textContent = "";
  notice.textContent = "";
  signupBtn.disabled = true;

  const name = nameInput.value.trim();
  const email = emailInput.value.trim();
  const password = passwordInput.value;

  if(!name || !email || !password){ 
    errorMsg.textContent="Fill all fields"; 
    signupBtn.disabled=false; 
    return; 
  }

  try {
    // Create auth with provided password
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;

    await updateProfile(user,{ displayName: name });
    const numericId = await generateUserId();

    await setDoc(doc(db,"users",user.uid),{
      userId: numericId,
      name: name,
      email: email,
      createdAt: new Date().toISOString()
    });

    notice.textContent = "Account created! Redirecting...";
    setTimeout(()=> window.location.href="Home.html",900);

  } catch(err){
    console.error(err);
    errorMsg.textContent = err.message || "Failed to create account.";
    signupBtn.disabled = false;
  }
});
</script>

</body>
</html>
